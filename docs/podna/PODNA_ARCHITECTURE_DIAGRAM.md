# Podna Agent System Architecture

## Visual System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PODNA AGENT SYSTEM                                 â”‚
â”‚                     AI-Powered Fashion Design Partner                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                   USER
                                     â”‚
                                     â”‚ Signs Up
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Registration  â”‚
                            â”‚  /auth/registerâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ Returns JWT Token
                                     â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Onboarding    â”‚
                            â”‚  /podna/onboardâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ Uploads ZIP (50+ images)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                            â”‚
        â”‚                            â”‚                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AGENT 1       â”‚          â”‚    AGENT 2      â”‚         â”‚    AGENT 4       â”‚
â”‚  Ingestion     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Style Descriptorâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Trend Analysis   â”‚
â”‚                â”‚          â”‚                 â”‚         â”‚                  â”‚
â”‚ â€¢ Extract ZIP  â”‚          â”‚ â€¢ Gemini Vision â”‚         â”‚ â€¢ Aggregate      â”‚
â”‚ â€¢ Deduplicate  â”‚          â”‚ â€¢ Extract attrs â”‚         â”‚ â€¢ Distributions  â”‚
â”‚ â€¢ Upload R2    â”‚          â”‚ â€¢ Normalize     â”‚         â”‚ â€¢ Clusters       â”‚
â”‚ â€¢ Embeddings   â”‚          â”‚ â€¢ Validate      â”‚         â”‚ â€¢ Summary        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                        â”‚
         â”‚                                                        â”‚
         â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                              â”‚   STYLE PROFILE    â”‚
         â”‚                                              â”‚                    â”‚
         â”‚                                              â”‚ â€¢ Style Labels     â”‚
         â”‚                                              â”‚ â€¢ Distributions    â”‚
         â”‚                                              â”‚ â€¢ Clusters         â”‚
         â”‚                                              â”‚ â€¢ Summary Text     â”‚
         â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                        â”‚
         â”‚                                                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ User wants to generate
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  AGENT 5       â”‚
                            â”‚ Prompt Builder â”‚
                            â”‚                â”‚
                            â”‚ â€¢ Read Profile â”‚
                            â”‚ â€¢ Bandit (Îµ=0.1)â”‚
                            â”‚ â€¢ Build Prompt â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ Prompt Text + JSON Spec
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  AGENT 6       â”‚
                            â”‚ Image Generatorâ”‚
                            â”‚                â”‚
                            â”‚ â€¢ Imagen-4     â”‚
                            â”‚ â€¢ Stable Diff  â”‚
                            â”‚ â€¢ Log Cost     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ Generated Image
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚    GALLERY     â”‚
                            â”‚                â”‚
                            â”‚  User Views &  â”‚
                            â”‚  Gives Feedbackâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ Like/Dislike/Critique
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  AGENT 7       â”‚
                            â”‚ Feedback Learnerâ”‚
                            â”‚                â”‚
                            â”‚ â€¢ Parse Critiqueâ”‚
                            â”‚ â€¢ Generate Î”   â”‚
                            â”‚ â€¢ Update Profileâ”‚
                            â”‚ â€¢ Record Historyâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ Learning Delta
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ STYLE PROFILE  â”‚
                            â”‚    UPDATED     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ Improved for next generation
                                     â”‚
                              âˆ LEARNING LOOP âˆ
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User    â”‚â”€â”€â”€â”€â–¶â”‚ ZIP File â”‚â”€â”€â”€â”€â–¶â”‚ Images   â”‚â”€â”€â”€â”€â–¶â”‚ Analyze  â”‚â”€â”€â”€â”€â–¶â”‚ Profile  â”‚
â”‚ Upload  â”‚     â”‚ 50+ imgs â”‚     â”‚ Extract  â”‚     â”‚ Gemini   â”‚     â”‚ Generate â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚                                â”‚
                                        â–¼                                â”‚
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
                                 â”‚ PostgreSQL â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚            â”‚
                                 â”‚ â€¢ portfolios
                                 â”‚ â€¢ images
                                 â”‚ â€¢ descriptors
                                 â”‚ â€¢ profiles
                                 â”‚ â€¢ prompts
                                 â”‚ â€¢ generations
                                 â”‚ â€¢ feedback
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next    â”‚â—€â”€â”€â”€â”€â”‚ Update   â”‚â—€â”€â”€â”€â”€â”‚ Feedback â”‚â—€â”€â”€â”€â”€â”‚ Generate â”‚â—€â”€â”€â”€â”€â”‚ Build    â”‚
â”‚ Gen     â”‚     â”‚ Profile  â”‚     â”‚ Process  â”‚     â”‚ Image    â”‚     â”‚ Prompt   â”‚
â”‚ Better! â”‚     â”‚ Learning â”‚     â”‚ Like/etc â”‚     â”‚ Imagen   â”‚     â”‚ Bandit   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Agent Responsibilities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AGENT SPECIALIZATIONS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  1ï¸âƒ£  INGESTION AGENT                                                       â”‚
â”‚     Input:  ZIP file buffer                                               â”‚
â”‚     Output: Portfolio record, image records, embeddings                   â”‚
â”‚     Tech:   AdmZip, crypto, R2 Storage, CLIP                             â”‚
â”‚     Cost:   Free (processing only)                                        â”‚
â”‚                                                                            â”‚
â”‚  2ï¸âƒ£  STYLE DESCRIPTOR AGENT                                                â”‚
â”‚     Input:  Image URL                                                     â”‚
â”‚     Output: Normalized fashion JSON                                       â”‚
â”‚     Tech:   Gemini 2.5 Flash vision                                      â”‚
â”‚     Cost:   ~$0.0001 per image                                           â”‚
â”‚                                                                            â”‚
â”‚  3ï¸âƒ£  TREND ANALYSIS AGENT                                                  â”‚
â”‚     Input:  All image descriptors                                         â”‚
â”‚     Output: Style profile (clusters, distributions, summary)              â”‚
â”‚     Tech:   Statistical aggregation                                       â”‚
â”‚     Cost:   Free (computation only)                                       â”‚
â”‚                                                                            â”‚
â”‚  4ï¸âƒ£  PROMPT BUILDER AGENT                                                  â”‚
â”‚     Input:  Style profile, constraints, history                           â”‚
â”‚     Output: Text prompt + JSON spec                                       â”‚
â”‚     Tech:   Epsilon-greedy bandit (Îµ=0.1)                                â”‚
â”‚     Cost:   Free (computation only)                                       â”‚
â”‚                                                                            â”‚
â”‚  5ï¸âƒ£  IMAGE GENERATION AGENT                                                â”‚
â”‚     Input:  Prompt text                                                   â”‚
â”‚     Output: Generated image URL                                           â”‚
â”‚     Tech:   Imagen-4 Ultra / Stable Diffusion                            â”‚
â”‚     Cost:   $0.04 / $0.02 per image                                      â”‚
â”‚                                                                            â”‚
â”‚  6ï¸âƒ£  FEEDBACK LEARNER AGENT                                                â”‚
â”‚     Input:  Feedback (like/dislike/critique)                              â”‚
â”‚     Output: Learning delta, updated profile                               â”‚
â”‚     Tech:   Gemini (critique parsing), RL updates                        â”‚
â”‚     Cost:   ~$0.0001 per feedback                                        â”‚
â”‚                                                                            â”‚
â”‚  7ï¸âƒ£  API ORCHESTRATION                                                     â”‚
â”‚     Input:  HTTP requests                                                 â”‚
â”‚     Output: Coordinated agent responses                                   â”‚
â”‚     Tech:   Express.js, JWT auth                                         â”‚
â”‚     Cost:   Free (server only)                                           â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATABASE TABLES (10)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        users (existing)
          â”‚
          â”‚ 1:N
          â–¼
      portfolios â”€â”€â”€â”€â”
          â”‚          â”‚
          â”‚ 1:N      â”‚ 1:N
          â–¼          â–¼
   portfolio_images  style_profiles
          â”‚                 â”‚
          â”‚ 1:1             â”‚ 1:N
          â–¼                 â–¼
   image_descriptors    prompts
          â”‚                 â”‚
          â”‚ 1:1             â”‚ 1:N
          â–¼                 â–¼
   image_embeddings    generations
                            â”‚
                            â”‚ 1:N
                            â–¼
                        feedback
                            â”‚
                            â”‚ 1:N
                            â–¼
                     learning_events
                            â”‚
                            â”‚ N:N
                            â–¼
                     prompt_history

Key Relationships:
â€¢ User â†’ Portfolios (1:N)
â€¢ Portfolio â†’ Images (1:N)
â€¢ Image â†’ Descriptor (1:1)
â€¢ Image â†’ Embedding (1:1)
â€¢ User â†’ StyleProfile (1:1)
â€¢ StyleProfile â†’ Prompts (1:N)
â€¢ Prompt â†’ Generation (1:N)
â€¢ Generation â†’ Feedback (1:N)
â€¢ Feedback â†’ LearningEvent (1:N)
â€¢ Prompt â†” PromptHistory (N:N)
```

---

## API Routes Tree

```
/api
â”œâ”€â”€ /auth
â”‚   â”œâ”€â”€ POST /register          (Sign up)
â”‚   â”œâ”€â”€ POST /login             (Sign in)
â”‚   â””â”€â”€ GET  /profile           (Get user info)
â”‚
â””â”€â”€ /podna
    â”œâ”€â”€ POST /onboard                    (ğŸŒŸ All-in-one: Upload + Analyze + Profile + Generate)
    â”‚
    â”œâ”€â”€ POST /upload                     (Upload ZIP only)
    â”œâ”€â”€ POST /analyze/:portfolioId       (Analyze images)
    â”œâ”€â”€ POST /profile/generate/:id       (Generate profile)
    â”‚
    â”œâ”€â”€ GET  /profile                    (View style profile)
    â”‚
    â”œâ”€â”€ POST /generate                   (Generate single image)
    â”œâ”€â”€ POST /generate/batch             (Generate multiple images)
    â”œâ”€â”€ GET  /gallery                    (View generated images)
    â”‚
    â”œâ”€â”€ POST /feedback                   (Submit feedback)
    â””â”€â”€ GET  /feedback                   (View feedback history)

ğŸŒŸ Recommended: Use /podna/onboard for complete workflow
```

---

## Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TECHNOLOGY LAYERS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        FRONTEND (Phase 2)                         â”‚    â”‚
â”‚  â”‚  â€¢ React / TypeScript                                             â”‚    â”‚
â”‚  â”‚  â€¢ Tailwind CSS                                                   â”‚    â”‚
â”‚  â”‚  â€¢ shadcn/ui components                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â”‚ REST API                               â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        API LAYER                                  â”‚    â”‚
â”‚  â”‚  â€¢ Express.js                                                     â”‚    â”‚
â”‚  â”‚  â€¢ JWT Authentication                                             â”‚    â”‚
â”‚  â”‚  â€¢ Multer (file upload)                                           â”‚    â”‚
â”‚  â”‚  â€¢ Rate limiting                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      AGENT SERVICES                               â”‚    â”‚
â”‚  â”‚  â€¢ Node.js services                                               â”‚    â”‚
â”‚  â”‚  â€¢ Async/await patterns                                           â”‚    â”‚
â”‚  â”‚  â€¢ Error handling                                                 â”‚    â”‚
â”‚  â”‚  â€¢ Logging (Winston)                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚              â”‚                     â”‚                     â”‚                 â”‚
â”‚              â–¼                     â–¼                     â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   AI SERVICES    â”‚  â”‚    DATABASE      â”‚  â”‚    STORAGE       â”‚        â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚        â”‚
â”‚  â”‚ â€¢ Gemini 2.5     â”‚  â”‚ â€¢ PostgreSQL 14+ â”‚  â”‚ â€¢ Cloudflare R2  â”‚        â”‚
â”‚  â”‚ â€¢ Imagen-4 Ultra â”‚  â”‚ â€¢ pgvector       â”‚  â”‚ â€¢ Signed URLs    â”‚        â”‚
â”‚  â”‚ â€¢ Stable Diff    â”‚  â”‚ â€¢ JSONB          â”‚  â”‚ â€¢ CDN            â”‚        â”‚
â”‚  â”‚ â€¢ CLIP (future)  â”‚  â”‚ â€¢ Indexes        â”‚  â”‚                  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Learning Loop Visualization

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   User Gives Feedback   â”‚
                    â”‚  Like / Dislike / Note  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Feedback Learner Agent â”‚
                    â”‚                         â”‚
                    â”‚  1. Parse Critique      â”‚
                    â”‚     "make this blue"    â”‚
                    â”‚      â†“                  â”‚
                    â”‚     {color: "blue"}     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Generate Delta        â”‚
                    â”‚                         â”‚
                    â”‚  Like:   +0.1 to attrs  â”‚
                    â”‚  Dislike: -0.05 to attrsâ”‚
                    â”‚  Critique: +0.3 to req  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Update Distributions  â”‚
                    â”‚                         â”‚
                    â”‚  colors: {              â”‚
                    â”‚    navy: 0.20 â†’ 0.18    â”‚
                    â”‚    blue: 0.15 â†’ 0.45    â”‚
                    â”‚  }                      â”‚
                    â”‚  â†“ Normalize to 1.0     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Record Prompt History  â”‚
                    â”‚                         â”‚
                    â”‚  was_liked: true        â”‚
                    â”‚  success_score: 1.0     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Next Generation Uses:  â”‚
                    â”‚                         â”‚
                    â”‚  â€¢ Updated profile      â”‚
                    â”‚  â€¢ Prompt history       â”‚
                    â”‚  â€¢ Bandit strategy      â”‚
                    â”‚                         â”‚
                    â”‚  Result: Better images! â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Bandit Strategy (Epsilon-Greedy)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Generate New Prompt    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Random(0-1) < 0.1?    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚          â”‚
                    YES    â”‚          â”‚    NO
                    (10%)  â”‚          â”‚    (90%)
                           â”‚          â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  EXPLORATION  â”‚   â”‚ EXPLOITATION  â”‚
              â”‚               â”‚   â”‚               â”‚
              â”‚ â€¢ Randomize   â”‚   â”‚ â€¢ Use best    â”‚
              â”‚   weights     â”‚   â”‚   patterns    â”‚
              â”‚ â€¢ Try new     â”‚   â”‚ â€¢ From historyâ”‚
              â”‚   combinationsâ”‚   â”‚ â€¢ High successâ”‚
              â”‚ â€¢ Discover    â”‚   â”‚   rate        â”‚
              â”‚   better      â”‚   â”‚               â”‚
              â”‚   patterns    â”‚   â”‚               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚               â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   Generate Image        â”‚
                  â”‚                         â”‚
                  â”‚   User feedback         â”‚
                  â”‚   updates strategy      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
â€¢ 90% Exploitation: Stick with what works
â€¢ 10% Exploration: Find better solutions
â€¢ Prevents local optima
â€¢ Continuous improvement
```

---

## Cost Breakdown

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          COST ANALYSIS                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  PER USER ONBOARDING (50 images)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Ingestion                               FREE                â”‚          â”‚
â”‚  â”‚  Vision Analysis (Gemini)     50 Ã— $0.0001 = $0.005         â”‚          â”‚
â”‚  â”‚  Profile Generation                      FREE                â”‚          â”‚
â”‚  â”‚  Initial Images (10)          10 Ã— $0.04  = $0.400          â”‚          â”‚
â”‚  â”‚                                           â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚          â”‚
â”‚  â”‚  TOTAL:                                   ~$0.41             â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚  PER IMAGE GENERATION                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Imagen-4 Ultra                           $0.04              â”‚          â”‚
â”‚  â”‚  Stable Diffusion XL (fallback)           $0.02              â”‚          â”‚
â”‚  â”‚  Real-ESRGAN Upscale (optional)           $0.01              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚  MONTHLY (100 active users, 50 generations/user/month)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Analysis            5,000 Ã— $0.0001  = $0.50               â”‚          â”‚
â”‚  â”‚  Generation          5,000 Ã— $0.04    = $200.00             â”‚          â”‚
â”‚  â”‚  Feedback Processing   100 Ã— $0.0001  = $0.01               â”‚          â”‚
â”‚  â”‚  Infrastructure (DB, R2, Redis)        = $50.00             â”‚          â”‚
â”‚  â”‚                                         â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚          â”‚
â”‚  â”‚  TOTAL:                                 ~$250.51/month      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚  COST OPTIMIZATION                                                          â”‚
â”‚  â€¢ Use Stable Diffusion for bulk: Save 50%                                â”‚
â”‚  â€¢ Cache similar prompts: Reduce redundant generation                      â”‚
â”‚  â€¢ Batch operations: Lower per-unit cost                                   â”‚
â”‚  â€¢ Smart limits: Prevent abuse                                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## System Performance

```
OPERATION              TIME        COST       NOTES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User Registration      < 1s        Free       JWT token generation
ZIP Upload (50 imgs)   ~30s        Free       Depends on file size
Image Analysis         ~5min       $0.005     50 Ã— Gemini vision calls
Profile Generation     < 5s        Free       Statistical aggregation
Single Generation      ~15s        $0.04      Imagen-4 Ultra API
Batch Generation (10)  ~2min       $0.40      Parallel processing
Feedback Processing    < 2s        $0.0001    Gemini critique parsing
Profile Update         < 1s        Free       Database update

BOTTLENECKS:
â€¢ Image analysis (5min for 50 images)
  â†’ Can be parallelized or made async
â€¢ Image generation (15s per image)
  â†’ Can batch or queue

SCALABILITY:
â€¢ Database: PostgreSQL handles millions of records
â€¢ Storage: R2 unlimited
â€¢ API: Rate limited to prevent abuse
â€¢ Agents: Stateless, horizontally scalable
```

---

This architecture is **production-ready** and **scalable**! ğŸš€
